import{e as i,g as D,o as b,c as v,a as t,q as L,b as E,s as u,v as m,y as N,x as C,d as w,F as V,z as B,r as S,A as M,B as P,C as j}from"./index-DiScHKU3.js";import{u as I,_ as T}from"./DeleteModal-B8X9CG1W.js";import{_ as q}from"./Pagination-crNKv_mf.js";import{u as z}from"./counter-BczK5lTF.js";import"./component-functions-D5LwSznC.js";import"./emitter-E5P-NQ8u.js";const A={class:"modal-dialog modal-xl",role:"document"},O={class:"modal-content border-0"},G={class:"modal-body"},H={class:"row"},J={class:"col-sm-4"},K={class:"mb-3"},Q=["src"],R={class:"col-sm-8"},W={class:"mb-3"},X={class:"row gx-2"},Y={class:"mb-3 col-md-6"},Z={class:"mb-3 col-md-6"},tt={class:"row gx-2"},et={class:"mb-3 col-md-6"},ot={class:"mb-3 col-md-6"},lt={class:"mb-3"},st={class:"mb-3"},at={class:"mb-3"},nt={class:"form-check"},rt={__name:"ProductModal",props:{product:{type:Object,default:()=>({})}},emits:["update-product"],setup(U,{expose:_,emit:x}){const f=i(null),o=i({}),y=U,g=x;D(()=>y.product,r=>{o.value={...r}},{deep:!0});const d=()=>{g("update-product",o.value)},{showModal:$,hideModal:h}=I(f),c=i(null),k=async()=>{try{const r=c.value.files[0];if(!r){alert("請選擇檔案");return}if(!r.type.match("image.*")){alert("請上傳圖片檔案");return}const e=new FormData;e.append("file-to-upload",r);const s=await C.post("https://vue3-course-api.hexschool.io/api/cart-yu2513/admin/upload",e);s.data.success?(o.value.imageUrl=s.data.imageUrl,alert("上傳成功"),console.log(o.value)):alert(s.data.message||"上傳失敗")}catch(r){console.error("上傳失敗:",r),alert("上傳失敗，請稍後再試")}};return _({showModal:$,hideModal:h,tempProduct:o}),(r,e)=>(b(),v("div",{class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"modal",ref:f},[t("div",A,[t("div",O,[e[21]||(e[21]=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},[t("span",null,"新增產品")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),t("div",G,[t("div",H,[t("div",J,[e[9]||(e[9]=t("div",{class:"mb-3"},[t("label",{for:"image",class:"form-label"},"輸入圖片網址"),t("input",{type:"text",class:"form-control",id:"image",placeholder:"請輸入圖片連結"})],-1)),t("div",K,[e[8]||(e[8]=t("label",{for:"customFile",class:"form-label"},[L("或 上傳圖片 "),t("i",{class:"fas fa-spinner fa-spin"})],-1)),t("input",{type:"file",id:"customFile",class:"form-control",ref_key:"fileInput",ref:c,onChange:k},null,544)]),t("img",{class:"img-fluid",alt:"",src:o.value.imageUrl},null,8,Q),e[10]||(e[10]=E('<div class="mt-5"><div class="mb-3 input-group"><input type="url" class="form-control form-control" placeholder="請輸入連結"><button type="button" class="btn btn-outline-danger"> 移除 </button></div><div><button class="btn btn-outline-primary btn-sm d-block w-100"> 新增圖片 </button></div></div>',1))]),t("div",R,[t("div",W,[e[11]||(e[11]=t("label",{for:"title",class:"form-label"},"標題",-1)),u(t("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":e[0]||(e[0]=l=>o.value.title=l),placeholder:"請輸入標題"},null,512),[[m,o.value.title]])]),t("div",X,[t("div",Y,[e[12]||(e[12]=t("label",{for:"category",class:"form-label"},"分類",-1)),u(t("input",{type:"text",class:"form-control",id:"category","onUpdate:modelValue":e[1]||(e[1]=l=>o.value.category=l),placeholder:"請輸入分類"},null,512),[[m,o.value.category]])]),t("div",Z,[e[13]||(e[13]=t("label",{for:"price",class:"form-label"},"單位",-1)),u(t("input",{type:"text",class:"form-control",id:"unit","onUpdate:modelValue":e[2]||(e[2]=l=>o.value.unit=l),placeholder:"請輸入單位"},null,512),[[m,o.value.unit]])])]),t("div",tt,[t("div",et,[e[14]||(e[14]=t("label",{for:"origin_price",class:"form-label"},"原價",-1)),u(t("input",{type:"number",class:"form-control",id:"origin_price","onUpdate:modelValue":e[3]||(e[3]=l=>o.value.origin_price=l),placeholder:"請輸入原價"},null,512),[[m,o.value.origin_price]])]),t("div",ot,[e[15]||(e[15]=t("label",{for:"price",class:"form-label"},"售價",-1)),u(t("input",{type:"number",class:"form-control",id:"price","onUpdate:modelValue":e[4]||(e[4]=l=>o.value.price=l),placeholder:"請輸入售價"},null,512),[[m,o.value.price]])])]),e[19]||(e[19]=t("hr",null,null,-1)),t("div",lt,[e[16]||(e[16]=t("label",{for:"description",class:"form-label"},"產品描述",-1)),u(t("textarea",{type:"text",class:"form-control",id:"description","onUpdate:modelValue":e[5]||(e[5]=l=>o.value.description=l),placeholder:"請輸入產品描述"},null,512),[[m,o.value.description]])]),t("div",st,[e[17]||(e[17]=t("label",{for:"content",class:"form-label"},"說明內容",-1)),u(t("textarea",{type:"text",class:"form-control",id:"content","onUpdate:modelValue":e[6]||(e[6]=l=>o.value.content=l),placeholder:"請輸入產品說明內容"},null,512),[[m,o.value.content]])]),t("div",at,[t("div",nt,[u(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=l=>o.value.is_enabled=l),"true-value":1,"false-value":0,id:"is_enabled"},null,512),[[N,o.value.is_enabled]]),e[18]||(e[18]=t("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1))])])])])]),t("div",{class:"modal-footer"},[e[20]||(e[20]=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"取消 ",-1)),t("button",{type:"button",class:"btn btn-primary",onClick:d},"確認")])])])],512))}},it={class:"text-end mt-2"},dt={class:"table mt-2"},ut={class:"text-right"},ct={class:"text-right"},pt={key:0,class:"text-success"},mt={key:1,class:"text-muted"},bt={class:"btn-group"},vt=["onClick"],ft=["onClick"],kt={__name:"Products",setup(U){const _=z(),x=j("emitter"),f=i([]),o=i({}),y=i(null),g=i(null),d=i({}),$=i(!1),h=i(!1),c=async(s=1)=>{try{h.value=!0;const a=`https://vue3-course-api.hexschool.io/api/cart-yu2513/admin/products/?page=${s}`,p=await C.get(a);h.value=!1,f.value=p.data.products,o.value=p.data.pagination}catch(a){console.error("Error during sign in:",a)}};c();const k=(s,a)=>{s?d.value={}:d.value={...a},$.value=s,y.value.showModal()},r=async s=>{try{let a="https://vue3-course-api.hexschool.io/api/cart-yu2513/admin/product",p="post";$.value||(a=`https://vue3-course-api.hexschool.io/api/cart-yu2513/admin/product/${s.id}`,p="put");const n=await C[p](a,{data:s});n.data.success?(y.value.hideModal(),c(),x.emit("push-message",{style:"success",title:"更新成功"})):x.emit("push-message",{style:"danger",title:"更新失敗",content:n.data.message.join("、")})}catch(a){console.error("Error during update product:",a)}},e=s=>{d.value={...s},g.value.showModal()},l=async()=>{try{const s=`https://vue3-course-api.hexschool.io/api/cart-yu2513/admin/product/${d.value.id}`;(await C.delete(s)).data.success&&(g.value.hideModal(),c())}catch(s){console.error("Error during delete product:",s)}};return(s,a)=>{const p=S("Loading");return b(),v(V,null,[w(p,{active:h.value},null,8,["active"]),t("div",it,[t("button",{class:"btn btn-primary",type:"button",onClick:a[0]||(a[0]=n=>k(!0))}," 增加一個產品 ")]),t("table",dt,[a[1]||(a[1]=t("thead",null,[t("tr",null,[t("th",{width:"120"},"分類"),t("th",null,"產品名稱"),t("th",{width:"120"},"原價"),t("th",{width:"120"},"售價"),t("th",{width:"100"},"是否啟用"),t("th",{width:"200"},"編輯")])],-1)),(b(!0),v(V,null,B(f.value,n=>(b(),v("tbody",{key:n.id},[t("tr",null,[t("td",null,M(n.category),1),t("td",null,M(n.title),1),t("td",ut,M(P(_).currency(n.origin_price)),1),t("td",ct,M(P(_).currency(n.price)),1),t("td",null,[n.is_enabled?(b(),v("span",pt,"啟用")):(b(),v("span",mt,"未啟用"))]),t("td",null,[t("div",bt,[t("button",{class:"btn btn-outline-primary btn-sm",onClick:F=>k(!1,n)},"編輯",8,vt),t("button",{class:"btn btn-outline-danger btn-sm",onClick:F=>e(n)},"刪除",8,ft)])])])]))),128))]),w(q,{pages:o.value,onEmitPages:c},null,8,["pages"]),w(rt,{ref_key:"productModal",ref:y,product:d.value,onUpdateProduct:r},null,8,["product"]),w(T,{item:d.value,ref_key:"delModal",ref:g,onDelItem:l},null,8,["item"])],64)}}};export{kt as default};
