import{r as n,i as w,o as p,c as m,a as e,w as f,v as M,k as V,s as L,f as g,F as E,l as T,d as $,e as B,t as k,m as N}from"./index-BkuwJpVc.js";import{u as F,_ as I}from"./DeleteModal-Cg_Zj1f-.js";import{u as D}from"./counter-BRGq6M10.js";import"./component-functions-DaCNwHYc.js";import"./emitter-E5P-NQ8u.js";const O={class:"modal-dialog",role:"document"},j={class:"modal-content"},A={class:"modal-body"},q={class:"mb-3"},z={class:"mb-3"},G={class:"mb-3"},H={class:"mb-3"},J={class:"mb-3"},K={class:"form-check"},P={__name:"CouponModal",props:{coupon:{type:Object,default:()=>({})}},emits:["update-coupon"],setup(C,{expose:v,emit:h}){D();const d=n(null),l=n({}),s=n(""),b=C,i=h,y=()=>{i("update-coupon",l.value)},{showModal:x,hideModal:r}=F(d);return w(()=>b.coupon,c=>{l.value=c;const o=new Date(l.value.due_date*1e3).toISOString().split("T");s.value=o[0]}),w(()=>s.value,c=>{l.value.due_date=Math.floor(new Date(c)/1e3)}),v({showModal:x,hideModal:r,tempCoupon:l}),(c,o)=>(p(),m("div",{class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"modal",ref:d},[e("div",O,[e("div",j,[o[11]||(o[11]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"exampleModalLabel"},"優惠券"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",A,[e("div",q,[o[5]||(o[5]=e("label",{for:"title"},"標題",-1)),f(e("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":o[0]||(o[0]=t=>l.value.title=t),placeholder:"請輸入標題"},null,512),[[M,l.value.title]])]),e("div",z,[o[6]||(o[6]=e("label",{for:"coupon_code"},"優惠碼",-1)),f(e("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":o[1]||(o[1]=t=>l.value.code=t),placeholder:"請輸入優惠碼"},null,512),[[M,l.value.code]])]),e("div",G,[o[7]||(o[7]=e("label",{for:"due_date"},"到期日",-1)),f(e("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":o[2]||(o[2]=t=>s.value=t)},null,512),[[M,s.value]])]),e("div",H,[o[8]||(o[8]=e("label",{for:"price"},"折扣百分比",-1)),f(e("input",{type:"number",class:"form-control",id:"price","onUpdate:modelValue":o[3]||(o[3]=t=>l.value.percent=t),placeholder:"請輸入折扣百分比"},null,512),[[M,l.value.percent,void 0,{number:!0}]])]),e("div",J,[e("div",K,[f(e("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":o[4]||(o[4]=t=>l.value.is_enabled=t),id:"is_enabled"},null,512),[[V,l.value.is_enabled]]),o[9]||(o[9]=e("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1))])])]),e("div",{class:"modal-footer"},[o[10]||(o[10]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:y},"更新優惠券 ")])])])],512))}},Q={class:"text-end mt-4"},R={class:"table mt-4"},W={key:0,class:"text-success"},X={key:1,class:"text-muted"},Y={class:"btn-group"},Z=["onClick"],ee=["onClick"],ne={__name:"Coupons",setup(C){const v=D(),h=n({}),d=n(null),l=n(null),s=n({}),b=n(!1),i=n(!1),y=(t,a)=>{b.value=t,b.value?s.value={due_date:new Date().getTime()/1e3}:s.value={...a},d.value.showModal()},x=t=>{s.value={...t},l.value.showModal()},r=async()=>{try{i.value=!0;const a=await $.get("https://vue3-course-api.hexschool.io/api/cart-yu2513/admin/coupons");h.value=a.data.coupons,i.value=!1}catch(t){console.error("Error during get coupons:",t)}},c=async t=>{try{if(b.value){const _=await $.post("https://vue3-course-api.hexschool.io/api/cart-yu2513/admin/coupon",{data:t});v.pushMessageState(_,"新增優惠券"),r(),d.value.hideModal()}else{const a=`https://vue3-course-api.hexschool.io/api/cart-yu2513/admin/coupon/${t.id}`,_=await $.put(a,{data:t});v.pushMessageState(_,"更新優惠券"),r(),d.value.hideModal()}}catch(a){console.error("Error during update coupons:",a)}},o=async()=>{try{i.value=!0;const t=`https://vue3-course-api.hexschool.io/api/cart-yu2513/admin/coupon/${s.value.id}`,a=await $.delete(t);l.value.hideModal(),r()}catch(t){console.error("Error during delete coupon:",t)}};return L(()=>{r()}),(t,a)=>{const _=B("Loading");return p(),m("div",null,[g(_,{active:i.value},null,8,["active"]),e("div",Q,[e("button",{class:"btn btn-primary",onClick:a[0]||(a[0]=u=>y(!0))}," 建立新的優惠券 ")]),e("table",R,[a[1]||(a[1]=e("thead",null,[e("tr",null,[e("th",null,"名稱"),e("th",null,"折扣百分比"),e("th",null,"到期日"),e("th",null,"是否啟用"),e("th",null,"編輯")])],-1)),e("tbody",null,[(p(!0),m(E,null,T(h.value,(u,S)=>(p(),m("tr",{key:S},[e("td",null,k(u.title),1),e("td",null,k(u.percent)+"%",1),e("td",null,k(N(v).date(u.due_date)),1),e("td",null,[u.is_enabled===1?(p(),m("span",W,"啟用")):(p(),m("span",X,"未起用"))]),e("td",null,[e("div",Y,[e("button",{class:"btn btn-outline-primary btn-sm",onClick:U=>y(!1,u)},"編輯",8,Z),e("button",{class:"btn btn-outline-danger btn-sm",onClick:U=>x(u)},"刪除",8,ee)])])]))),128))])]),g(P,{coupon:s.value,ref_key:"couponModal",ref:d,onUpdateCoupon:c},null,8,["coupon"]),g(I,{item:s.value,ref_key:"delModal",ref:l,onDelItem:o},null,8,["item"])])}}};export{ne as default};
